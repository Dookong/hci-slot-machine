App={web3Provider:null,contracts:{},balance:0,account:null,instance:null,machine1:null,machine2:null,machine3:null,started:0,roll1:-1,roll2:-1,roll3:-1,rolled:!1,audio:null,init:function(){return App.audio=document.getElementById("audio"),$("#desc").hide(),App.initWeb3()},initWeb3:function(){return"undefined"!=typeof web3?(App.web3Provider=web3.currentProvider,web3=new Web3(web3.currentProvider)):(App.web3Provider=new Web3.providers.HttpProvider("https://eth-sepolia.g.alchemy.com/"),web3=new Web3(App.web3Provider),toastr.warning("메타마스크 확장 프로그램이 필요합니다!")),App.initContract()},initContract:function(){return $.getJSON("SlotMachine.json",(function(t){var e=t;try{App.contracts.SlotMachine=TruffleContract(e),App.contracts.SlotMachine.setProvider(App.web3Provider),App.checkAccount(),App.slotMachine()}catch(t){console.log(t)}})),App.bindEvents()},bindEvents:function(){$(document).on("click","#slotMachineButtonShuffle",App.startRoll),$(document).on("click","#withdraw",App.withdraw)},withdraw:function(){App.checkBalance(),0!=App.balance?instance.withdraw.sendTransaction({from:App.account,value:0}).then((function(t){console.log(t),setTimeout(App.checkBalance,2e3)})).catch((function(t){console.log(t)})):toastr.error("출금가능한 상금이 없습니다:(")},checkAccount:function(){web3.eth.getAccounts((function(t,e){App.account=e[0],App.contracts.SlotMachine.deployed().then((function(t){instance=t,instance.Rolled().watch((function(t,e){"Rolled"===e.event&&($("#slotMachineButtonStop").attr("disabled",!1),$("#slotMachineButtonStop").attr("title",""),$("#header-msg").text("슬롯머신(탈중앙화)"),App.roll1=e.args.rand1.valueOf(),App.roll2=e.args.rand2.valueOf(),App.roll3=e.args.rand3.valueOf(),App.rolled=!0,console.log(App.roll1,App.roll2,App.roll3),toastr.success("처리 완료!","정지 버튼을 눌러서 결과를 확인하세요"),App.audio.play(),setTimeout(App.checkBalance,1e3),url=`https://sepolia.etherscan.io/tx/${e.transactionHash}`,$("#etherscan").text(url),$("#etherscan").attr("href",url),$("#desc").show())})),App.checkBalance()})).catch((function(t){toastr.warning("이더리움 지갑 연결을 확인하세요!")}))}))},checkBalance:function(){instance.balanceOf.call(App.account).then((function(t){App.balance=t.valueOf();var e=web3.fromWei(App.balance,"ether");$("#balance").text(e+" ether")}))},startRoll:function(){event.preventDefault(),0==App.started&&App.contracts.SlotMachine.deployed().then((function(t){return t.oneRoll.sendTransaction({from:App.account,value:web3.toWei("0.01","ether")})})).then((function(){App.startShuffle()})).catch((function(t){toastr.warning("이더리움 지갑 연결을 확인하세요!")}))},prizeWon:function(){audio.pause(),audio.load();var t;t=5==App.roll1&&5==App.roll2&&5==App.roll3?"잭팟!! 1 이더리움 획득!":6==App.roll1&&6==App.roll2&&6==App.roll3?"축하합니다! 0.1 이더리움 획득!":4==App.roll1&&4==App.roll2&&4==App.roll3?"축하합니다! 0.05 이더리움 획득!":3==App.roll1&&3==App.roll2&&3==App.roll3?"축하합니다! 0.04 이더리움 획득!":2==App.roll1&&2==App.roll2&&2==App.roll3?"축하합니다! 0.03 이더리움 획득!":1==App.roll1&&1==App.roll2&&1==App.roll3?"축하합니다! 0.02 이더리움 획득!":App.roll1==App.roll2||App.roll1==App.roll3||App.roll2==App.roll3?"보너스 스핀! 0.01 이더리움 획득!":"낙첨! 다음 기회를 노려보세요ㅠㅠ",$("#header-msg").text(t),App.checkBalance(),toastr.success(t),$("#slotMachineButtonShuffle").attr("disabled",!1)},startShuffle:function(){App.started=3,App.machine1.shuffle(),App.machine2.shuffle(),App.machine3.shuffle(),$("#slotMachineButtonShuffle").attr("disabled",!0),$("#slotMachineButtonStop").attr("disabled",!0);var t="스마트 컨트랙트 트랜잭션 처리중..";$("#slotMachineButtonStop").attr("title",t),$("#header-msg").text(t)},slotMachine:function(){App.machine1=$("#casino1").slotMachine({active:0,delay:500}),App.machine2=$("#casino2").slotMachine({active:1,delay:500}),App.machine3=$("#casino3").slotMachine({active:2,delay:500}),App.machine1.setRandomize((function(){return App.roll1-1})),App.machine2.setRandomize((function(){return App.roll2-1})),App.machine3.setRandomize((function(){return App.roll3-1})),App.started=0,$("#slotMachineButtonStop").click((function(){if(App.rolled){switch(App.started){case 3:App.machine1.stop();break;case 2:App.machine2.stop();break;case 1:App.machine3.stop(),App.prizeWon(),App.rolled=!1}App.started--}}))}},$((function(){$(window).load((function(){App.init()}))}));